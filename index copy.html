<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TACTICAL INTEL VAULT</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #ec4899;
            --bg: #f1f5f9;
            --glass: rgba(255, 255, 255, 0.8);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: #1e293b; min-height: 100vh; font-size: 14px; }

        /* --- HEADER --- */
        header { 
            position: fixed; top: 0; width: 100%; height: 70px; 
            display: flex; align-items: center; justify-content: space-between; 
            background: var(--glass); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.05); padding: 0 20px;
        }
        header h1 { font-size: 1.1rem; font-weight: 800; color: var(--primary); }

        /* --- CONTENT --- */
        .content { padding: 90px 15px 30px; max-width: 1100px; margin: 0 auto; }
        
        .controls { display: flex; gap: 10px; margin-bottom: 25px; }
        .btn { 
            padding: 10px 18px; border-radius: 10px; border: none; font-weight: 700; 
            cursor: pointer; font-size: 0.85rem; transition: 0.2s; display: flex; align-items: center; gap: 8px;
        }
        .btn-main { background: var(--primary); color: white; }
        .btn-add-data { background: #10b981; color: white; padding: 6px 12px; font-size: 0.75rem; }
        .btn-del-table { background: #fee2e2; color: #ef4444; font-size: 0.7rem; }

        /* --- TABLE CARD --- */
        .table-wrapper { 
            background: white; border-radius: 16px; margin-bottom: 30px; 
            overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.05);
        }
        .table-header { 
            padding: 15px 20px; background: #f8fafc; border-bottom: 1px solid #edf2f7;
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;
        }
        .table-header h2 { font-size: 0.9rem; font-weight: 800; text-transform: uppercase; color: #475569; }

        .scroll-area { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        th { background: #fdfdfd; padding: 12px 15px; font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; text-align: left; border-bottom: 2px solid #f1f5f9; }
        td { padding: 12px 15px; border-bottom: 1px solid #f1f5f9; line-height: 1.4; vertical-align: top; }
        textarea.cell-view { width: 100%; border: none; background: transparent; resize: none; font-size: 0.85rem; color: #475569; font-weight: 500; }

        /* --- MODAL / POPUP --- */
        .modal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px);
            display: none; align-items: center; justify-content: center; z-index: 2000; padding: 15px;
        }
        .modal-content { 
            background: white; padding: 25px; border-radius: 20px; width: 100%; max-width: 500px; 
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        .modal-content h3 { margin-bottom: 20px; font-size: 1.1rem; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.75rem; font-weight: 700; margin-bottom: 6px; color: #64748b; }
        input, textarea { 
            width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #e2e8f0; 
            font-size: 0.9rem; outline: none; background: #f8fafc;
        }
        textarea { height: 100px; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }

        /* --- TOAST --- */
        #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 3000; }
        .toast { padding: 12px 24px; border-radius: 50px; color: white; font-weight: 700; font-size: 0.8rem; box-shadow: 0 10px 15px rgba(0,0,0,0.1); }
        .toast.success { background: #10b981; }
        .toast.error { background: #ef4444; }

        @media (max-width: 600px) {
            header h1 { font-size: 0.9rem; }
            .content { padding-top: 80px; }
            .btn { padding: 8px 14px; font-size: 0.75rem; }
            td, th { padding: 10px; font-size: 0.8rem; }
        }
    </style>
</head>
<body>

    <div id="toast-container"></div>

    <header>
        <h1>TACTICAL INTEL VAULT</h1>
        <div class="profile-wrap" style="width:35px; height:35px; border-radius:50%; overflow:hidden; border:2px solid var(--primary)">
            <img src="file/upgradediri.jpg" alt="P" style="width:100%; height:100%; object-fit:cover;">
        </div>
    </header>

    <div class="content">
        <div class="controls">
            <button class="btn btn-main" onclick="openTableModal()">+ BUAT TABEL BARU</button>
        </div>
        <div id="master-container"></div>
    </div>

    <div id="modal-table" class="modal">
        <div class="modal-content">
            <h3>Konfigurasi Tabel Baru</h3>
            <div class="form-group">
                <label>NAMA TABEL</label>
                <input type="text" id="new-table-name" placeholder="Misal: Data Audit Trading">
            </div>
            <div class="form-group">
                <label>KOLOM (Pisahkan dengan koma)</label>
                <input type="text" id="new-table-cols" placeholder="Misal: Istilah, Keterangan, Level">
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('modal-table')">Batal</button>
                <button class="btn btn-main" onclick="createNewTable()">Buat Tabel</button>
            </div>
        </div>
    </div>

    <div id="modal-data" class="modal">
        <div class="modal-content">
            <h3 id="data-modal-title">Tambah Data</h3>
            <div id="dynamic-inputs"></div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('modal-data')">Batal</button>
                <button class="btn btn-main" onclick="submitData()">Simpan ke Cloud</button>
            </div>
        </div>
    </div>

    <script>
        const REPO_OWNER = "doniusdarmanyantogiawa";
        const REPO_NAME = "superlinkjetempur";
        const FILE_PATH = "audit_vault.json";

        let vault = [], fileSha = "", currentTargetTableId = null;

        function showToast(msg, type='success') {
            const c = document.getElementById('toast-container');
            const t = document.createElement('div');
            t.className = `toast ${type}`; t.innerText = msg;
            c.appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }

        async function load() {
            try {
                const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`);
                if(!res.ok) throw new Error();
                const data = await res.json();
                fileSha = data.sha;
                vault = JSON.parse(atob(data.content));
                draw();
            } catch (e) { console.log("Vault Kosong..."); draw(); }
        }

        function draw() {
            const container = document.getElementById('master-container');
            container.innerHTML = '';
            
            vault.forEach(table => {
                const wrap = document.createElement('div');
                wrap.className = 'table-wrapper';
                
                let headers = table.columns.map(c => `<th>${c}</th>`).join('');
                let rows = table.data.map(row => `
                    <tr>
                        ${table.columns.map(c => `<td><div class="cell-view">${row[c] || '-'}</div></td>`).join('')}
                        <td style="width:40px"><span style="color:#ef4444; cursor:pointer;" onclick="deleteRow('${table.id}', '${row._id}')">âœ•</span></td>
                    </tr>
                `).join('');

                wrap.innerHTML = `
                    <div class="table-header">
                        <h2>${table.name}</h2>
                        <div style="display:flex; gap:8px;">
                            <button class="btn btn-add-data" onclick="openDataModal('${table.id}')">+ Data</button>
                            <button class="btn btn-del-table" onclick="deleteTable('${table.id}')">Hapus Tabel</button>
                        </div>
                    </div>
                    <div class="scroll-area">
                        <table>
                            <thead><tr>${headers}<th style="width:40px"></th></tr></thead>
                            <tbody>${rows}</tbody>
                        </table>
                    </div>
                `;
                container.appendChild(wrap);
            });
        }

        // --- LOGIC MODAL ---
        function openTableModal() { document.getElementById('modal-table').style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        function createNewTable() {
            const name = document.getElementById('new-table-name').value;
            const colsRaw = document.getElementById('new-table-cols').value;
            if(!name || !colsRaw) return alert("Isi nama dan kolom!");

            const columns = colsRaw.split(',').map(c => c.trim()).filter(c => c !== "");
            const newTable = { id: 't' + Date.now(), name, columns, data: [] };
            
            vault.push(newTable);
            saveToGithub("Buat Tabel Baru");
            closeModal('modal-table');
        }

        function openDataModal(tableId) {
            currentTargetTableId = tableId;
            const table = vault.find(t => t.id === tableId);
            const container = document.getElementById('dynamic-inputs');
            container.innerHTML = '';

            table.columns.forEach(col => {
                const group = document.createElement('div');
                group.className = 'form-group';
                group.innerHTML = `<label>${col.toUpperCase()}</label>
                                   <textarea id="inp-${col}" class="dynamic-field" placeholder="Masukkan ${col}..."></textarea>`;
                container.appendChild(group);
            });

            document.getElementById('modal-data').style.display = 'flex';
        }

        function submitData() {
            const table = vault.find(t => t.id === currentTargetTableId);
            const newData = { _id: 'r' + Date.now() };
            
            table.columns.forEach(col => {
                newData[col] = document.getElementById(`inp-${col}`).value;
            });

            table.data.unshift(newData);
            saveToGithub("Tambah Baris Data");
            closeModal('modal-data');
        }

        async function deleteRow(tableId, rowId) {
            if(!confirm("Hapus baris ini?")) return;
            const table = vault.find(t => t.id === tableId);
            table.data = table.data.filter(r => r._id !== rowId);
            saveToGithub("Hapus Baris");
        }

        async function deleteTable(tableId) {
            if(!confirm("Hapus seluruh tabel ini?")) return;
            vault = vault.filter(t => t.id !== tableId);
            saveToGithub("Hapus Tabel");
        }

        // --- GITHUB SYNC ---
        async function saveToGithub(msg) {
            const token = prompt("MASUKKAN TOKEN GITHUB UNTUK OTORISASI:");
            if(!token) return showToast("Aksi dibatalkan", "error");

            try {
                const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`, {
                    method: "PUT",
                    headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: msg,
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(vault, null, 2)))),
                        sha: fileSha
                    })
                });

                if(res.ok) {
                    const resData = await res.json();
                    fileSha = resData.content.sha;
                    showToast("Cloud Berhasil Diupdate!");
                    draw();
                } else {
                    showToast("Gagal! Token mungkin salah.", "error");
                    load(); // Reload data asli
                }
            } catch (e) {
                showToast("Kesalahan Koneksi", "error");
            }
        }

        load();
    </script>
</body>
</html>